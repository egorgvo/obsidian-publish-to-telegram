"use strict";var E=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var h=Object.prototype.hasOwnProperty;var d=(a,t)=>{for(var e in t)E(a,e,{get:t[e],enumerable:!0})},C=(a,t,e,T)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of S(t))!h.call(a,i)&&i!==e&&E(a,i,{get:()=>t[i],enumerable:!(T=I(t,i))||T.enumerable});return a};var c=a=>C(E({},"__esModule",{value:!0}),a);var O={};d(O,{default:()=>o});module.exports=c(O);var s=require("obsidian");var N=require("obsidian");var _={MENU_TITLE:"Publish to Telegram",NOTICE_SUCCESS:"Published to Telegram \u2705",NOTICE_ERR_CONFIG:"Error: Check Telegram settings (Token and Chat ID).",NOTICE_ERR_SEND:"Send error: ",SETTING_HEADER:"Telegram Bot Settings",SETTING_BOT_TOKEN_NAME:"Bot Token",SETTING_BOT_TOKEN_DESC:"Get this from @BotFather",SETTING_CHAT_ID_NAME:"Chat ID",SETTING_CHAT_ID_DESC:"Target Group or Channel ID",SETTING_PLACEHOLDER_TOKEN:"Enter token...",SETTING_PLACEHOLDER_CHAT:"-100..."};var g={MENU_TITLE:"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C \u0432 Telegram",NOTICE_SUCCESS:"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u043D\u043E \u0432 Telegram \u2705",NOTICE_ERR_CONFIG:"\u041E\u0448\u0438\u0431\u043A\u0430: \u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 Telegram (Token \u0438 Chat ID).",NOTICE_ERR_SEND:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0438: ",SETTING_HEADER:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 Telegram Bot",SETTING_BOT_TOKEN_NAME:"\u0422\u043E\u043A\u0435\u043D \u0431\u043E\u0442\u0430",SETTING_BOT_TOKEN_DESC:"\u041F\u043E\u043B\u0443\u0447\u0438\u0442\u0435 \u0435\u0433\u043E \u0443 @BotFather",SETTING_CHAT_ID_NAME:"ID \u0447\u0430\u0442\u0430",SETTING_CHAT_ID_DESC:"ID \u0433\u0440\u0443\u043F\u043F\u044B \u0438\u043B\u0438 \u043A\u0430\u043D\u0430\u043B\u0430 (\u043D\u0430\u0447\u0438\u043D\u0430\u0435\u0442\u0441\u044F \u0441 -100)",SETTING_PLACEHOLDER_TOKEN:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u043E\u043A\u0435\u043D...",SETTING_PLACEHOLDER_CHAT:"-100..."};var l={en:_,ru:g},p=N.moment.locale(),n=l[p]||l.en;var m={botToken:"",chatId:""},o=class extends s.Plugin{settings;async onload(){await this.loadSettings(),this.addSettingTab(new r(this.app,this)),this.registerEvent(this.app.workspace.on("file-menu",(t,e)=>{e instanceof s.TFile&&t.addItem(T=>{T.setTitle(n.MENU_TITLE).setIcon("paper-plane").onClick(async()=>{await this.sendNoteToTelegram(e)})})}))}async sendNoteToTelegram(t){if(!this.settings.botToken||!this.settings.chatId){new s.Notice(n.NOTICE_ERR_CONFIG);return}try{let e=await this.app.vault.read(t),T={chat_id:this.settings.chatId,text:e,parse_mode:"Markdown"},i=await fetch(`https://api.telegram.org/bot${this.settings.botToken}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)});if(!i.ok)throw new Error(`Status: ${i.status}`);new s.Notice(n.NOTICE_SUCCESS)}catch(e){new s.Notice(`${n.NOTICE_ERR_SEND}${e.message}`)}}async loadSettings(){this.settings=Object.assign({},m,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},r=class extends s.PluginSettingTab{plugin;constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new s.Setting(t).setHeading().setName(n.SETTING_HEADER),t.addClass("telegram-settings-container"),new s.Setting(t).setName(n.SETTING_BOT_TOKEN_NAME).setDesc(n.SETTING_BOT_TOKEN_DESC).addText(e=>e.setPlaceholder(n.SETTING_PLACEHOLDER_TOKEN).setValue(this.plugin.settings.botToken).onChange(async T=>{this.plugin.settings.botToken=T,await this.plugin.saveSettings()})),new s.Setting(t).setName(n.SETTING_CHAT_ID_NAME).setDesc(n.SETTING_CHAT_ID_DESC).addText(e=>e.setPlaceholder(n.SETTING_PLACEHOLDER_CHAT).setValue(this.plugin.settings.chatId).onChange(async T=>{this.plugin.settings.chatId=T,await this.plugin.saveSettings()}))}};
